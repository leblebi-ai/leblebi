## Acceptance Criteria
- [ ] Canvas animates during workflow execution
- [ ] Active node pulses/glows
- [ ] Completed nodes show green checkmark
- [ ] Failed nodes show red X with error details
- [ ] Wires animate with flowing dots showing data direction
- [ ] Right panel shows live log stream
- [ ] Human Approval Node highlights with "Waiting" badge
- [ ] Execution history shows past runs with status and output links
- [ ] All entities generated using ZFA (Zorphy) with JSON serialization
- [ ] All Clean Architecture layers generated using ZFA generate command
- [ ] State management using ZFA-generated State classes

## Task
Implement the Workflow Execution View that shows real-time visualization of running workflows.

### Execution View Layout:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  Running: Email Triage        [Pause] [Stop]    Status: â— Running
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                    â”‚             â”‚
â”‚   Canvas     â”‚                                    â”‚ Log Panel   â”‚
â”‚              â”‚                                    â”‚             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”‚ 10:45:23    â”‚
â”‚   â”‚ âœ“     â”‚  â”‚   â”‚ â—     â”‚â”€â”€â”€â–¶â”‚ â—‹     â”‚         â”‚ Trigger:    â”‚
â”‚   â”‚Triggerâ”‚â”€â”€â”‚â”€â”€â–¶â”‚Agent  â”‚    â”‚Output â”‚         â”‚ New email   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ received    â”‚
â”‚              â”‚        â”‚                         â”‚             â”‚
â”‚              â”‚        â–¼                         â”‚ 10:45:25    â”‚
â”‚              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                      â”‚ Agent:      â”‚
â”‚              â”‚   â”‚ âœ—     â”‚                      â”‚ Processing  â”‚
â”‚              â”‚   â”‚Failed â”‚                      â”‚ email...    â”‚
â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚              â”‚       â”‚                          â”‚ 10:45:30    â”‚
â”‚              â”‚       â–¼                          â”‚ Error:      â”‚
â”‚              â”‚   âš ï¸ Error                        â”‚ API timeout â”‚
â”‚              â”‚                                    â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Started: 10:45 AM  â”‚  Duration: 45s  â”‚  Nodes: 2/5 complete   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Node States During Execution:

**1. Waiting (â—‹)**
- Gray/neutral appearance
- Not yet reached
- Default state before execution starts

**2. Active (â—)**
- Pulses with glow effect
- Animated border
- Spinner or activity indicator
- Shows current action in tooltip

**3. Completed (âœ“)**
- Green checkmark badge
- Subtle green border
- Shows output summary on hover

**4. Failed (âœ—)**
- Red X badge
- Red border
- Error message visible
- Retry button appears

**5. Waiting for Approval (âœ‹)**
- Amber/yellow pulsing
- "Waiting" badge
- Notification sent
- Approval controls appear

### Wire Animations:

**Active Connection:**
- Animated dots flow along wire
- Direction matches data flow
- Speed indicates processing
- Color matches data type

**Wire States:**
- **Inactive:** Gray, static
- **Data Flowing:** Animated dots, blue/green
- **Error:** Red with warning icon
- **Waiting:** Amber, paused animation

### Log Panel:

**Location:** Right side panel (collapsible on mobile)

**Log Entry Format:**
```
[timestamp] [node_name] [status] [message]

10:45:23  Trigger      âœ“     New email received from john@example.com
10:45:24  Classifier   â—     Processing email content...
10:45:28  Classifier   âœ“     Classified as: High Priority
10:45:29  Drafter      â—     Generating reply draft...
10:45:35  Drafter      âœ“     Draft created (150 words)
10:45:36  Approval     âœ‹     Waiting for user approval
```

**Log Features:**
- Auto-scroll to latest entry
- Filter by node
- Filter by status (info, warning, error)
- Search within logs
- Export logs as text file
- Timestamp links to node on canvas

### Human Approval Node:

**When Approval Node is Reached:**

1. **Canvas Updates:**
   - Node pulses amber
   - "Waiting for Approval" badge
   - Execution pauses

2. **Notification Sent:**
   - Push notification
   - In-app notification
   - Badge on workflow icon

3. **Approval UI Appears:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Approval Required               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Draft Reply to john@example.com    â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Hi John,                    â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ Thank you for your email... â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ âœï¸ Edit   â”‚  â”‚ âŒ Reject â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚     âœ… Approve           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Approval Actions:**
- **Approve:** Continues workflow execution
- **Reject:** Stops workflow or follows rejection path
- **Edit:** Opens editor, then approve/reject

**Timeout Handling:**
- Configurable timeout (default: 24 hours)
- Timeout action: Auto-approve, Auto-reject, or Stop
- Warning notification before timeout

### Execution Controls:

**Top Bar Controls:**

1. **Pause Button:**
   - Pauses execution at next safe point
   - Current node completes
   - Button changes to "Resume"
   - Workflow state preserved

2. **Stop Button:**
   - Immediately stops execution
   - Confirmation dialog
   - Partial results saved
   - Logs preserved

3. **Status Indicator:**
   - â— Running (green pulse)
   - â¸ Paused (amber)
   - â¹ Stopped (gray)
   - âœ“ Complete (green check)
   - âœ— Failed (red X)

### Progress Indicators:

**Bottom Status Bar:**
- **Started:** Execution start time
- **Duration:** Elapsed time (updates live)
- **Nodes:** Progress count (e.g., "2/5 complete")
- **Current Step:** Name of active node

**Progress Bar:**
- Horizontal bar at top
- Fills as nodes complete
- Color indicates status

### Error Handling:

**When Node Fails:**

1. **Visual Feedback:**
   - Node shows red X
   - Wire shows error indicator
   - Error message in log

2. **Error Details Panel:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Error in "API Call" Node        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Type: Connection Timeout           â”‚
â”‚  Message: Request timed out after   â”‚
â”‚          30 seconds                 â”‚
â”‚                                     â”‚
â”‚  Stack Trace:                       â”‚
â”‚  [Expandable details]               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ”„ Retry  â”‚  â”‚ â­ Skip    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚      Stop Workflow       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Error Actions:**
- **Retry:** Re-run failed node
- **Skip:** Continue without this node (if possible)
- **Stop:** End workflow execution

### Execution History:

**Access:** From workflow detail screen â†’ "History" tab

**History List:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Execution History                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  âœ“ Today, 10:45 AM                  â”‚
â”‚    Duration: 2m 30s                 â”‚
â”‚    Nodes: 5/5 complete              â”‚
â”‚    [View Details]                   â”‚
â”‚                                     â”‚
â”‚  âœ— Today, 9:15 AM                   â”‚
â”‚    Duration: 45s                    â”‚
â”‚    Failed at: API Call              â”‚
â”‚    Error: Connection timeout        â”‚
â”‚    [View Details] [Re-run]          â”‚
â”‚                                     â”‚
â”‚  âœ“ Yesterday, 8:00 AM               â”‚
â”‚    Duration: 1m 15s                 â”‚
â”‚    Nodes: 5/5 complete              â”‚
â”‚    [View Details] [Re-run]          â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**History Entry Details:**
- Execution timestamp
- Duration
- Status (success/failed)
- Node completion status
- Error details (if failed)
- Full log
- Output links
- Re-run button

### Re-run Functionality:

**From History:**
1. Tap "Re-run" on past execution
2. Confirm re-run
3. Uses same input data
4. Opens execution view

**Re-run Options:**
- **Full Re-run:** Start from beginning
- **From Failed Node:** Resume from failure point
- **With New Input:** Modify input before running

### Output Access:

**During/After Execution:**
- Tap completed output node
- View generated output
- Download file (if applicable)
- Copy to clipboard
- Share output

### Mobile Execution View:

**Adaptations:**
- Canvas fills most of screen
- Log panel as pull-up bottom sheet
- Simplified node states
- Tap node for details
- Swipe between canvas and logs

### Notifications During Execution:

**Push Notifications:**
- Workflow started
- Approval required
- Workflow completed
- Workflow failed

**In-App:**
- Status bar update
- Badge on workflow icon
- Toast for key events

### State Management:

**Execution State:**
```javascript
{
  workflowId: string,
  executionId: string,
  status: enum, // running, paused, stopped, complete, failed
  startedAt: timestamp,
  completedAt: timestamp,
  currentNodeId: string,
  nodeStates: {
    [nodeId]: {
      status: enum,
      startedAt: timestamp,
      completedAt: timestamp,
      output: any,
      error: Error
    }
  },
  logs: LogEntry[]
}
```

### Performance:
- Efficient canvas re-rendering
- Throttled animations (60fps target)
- Virtual scrolling for logs
- Lazy load historical executions

## ZFA Architecture Requirements

### Entity Definition

**WorkflowExecution Entity:**
```bash
zfa entity create -n WorkflowExecution --field "id:String,workflowId:String,status:String,startedAt:DateTime,completedAt:DateTime?,currentNodeId:String?,nodeStates:Map<String,dynamic>,error:String?,createdAt:DateTime" --json
```

**ExecutionLog Entity:**
```bash
zfa entity create -n ExecutionLog --field "id:String,executionId:String,nodeId:String,nodeName:String,level:String,message:String,timestamp:DateTime" --json
```

**ExecutionStatus Enum:**
```bash
zfa entity enum -n ExecutionStatus --value running,paused,stopped,complete,failed
```

### Clean Architecture Generation

```bash
zfa generate WorkflowExecution --methods=get,getList,create,update --data --vpc --state
zfa generate ExecutionLog --methods=get,getList,create --data --vpc --state
```

### Implementation Notes

1. **Real-time Updates**: Use WebSocket to push execution state changes
2. **Node States**: Store per-node status in `nodeStates` map
3. **Logs**: Stream logs to `ExecutionLog` entities during execution

