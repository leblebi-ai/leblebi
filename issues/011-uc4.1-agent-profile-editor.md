## Acceptance Criteria
- [ ] Full-page editor accessible from agent card â†’ "Edit"
- [ ] Sections: Identity, Model, System Prompt, Tools/Skills, Permissions, Memory
- [ ] Scrollable form with collapsible groups
- [ ] Live preview pane on desktop showing agent card appearance
- [ ] "Test" button opens temporary chat to test configuration
- [ ] All entities generated using ZFA (Zorphy) with JSON serialization
- [ ] All Clean Architecture layers generated using ZFA generate command
- [ ] State management using ZFA-generated State classes

## Task
Implement the Agent Profile Editor for configuring all aspects of an agent.

### Screen Layout:

**Mobile:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  Edit Agent                 Save â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Avatar]                   â”‚   â”‚
â”‚  â”‚  Tap to change              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  Name: [________________]          â”‚
â”‚  Description: [_____________]      â”‚
â”‚                                     â”‚
â”‚  â–¼ Model Settings                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                     â”‚
â”‚  â–¼ System Prompt                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                     â”‚
â”‚  â–¼ Tools & Skills                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                     â”‚
â”‚  â–¼ Permissions                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                     â”‚
â”‚  â–¼ Memory Settings                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚      Test Agent          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Desktop:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  Edit Agent                                       Save â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [Avatar]                   â”‚     â”‚  â”‚   Preview   â”‚  â”‚
â”‚  â”‚  Tap to change              â”‚     â”‚  â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚                                       â”‚  â”‚ â”‚ [Ava]   â”‚ â”‚  â”‚
â”‚  Name: [________________]            â”‚  â”‚ â”‚ Agent   â”‚ â”‚  â”‚
â”‚  Description: [_____________]        â”‚  â”‚ â”‚ Name    â”‚ â”‚  â”‚
â”‚                                       â”‚  â”‚ â”‚ Idle    â”‚ â”‚  â”‚
â”‚  â–¼ Model Settings                    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â”‚             â”‚  â”‚
â”‚                                       â”‚  â”‚ Last active â”‚  â”‚
â”‚  â–¼ System Prompt                     â”‚  â”‚ 2 min ago   â”‚  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚                   â”‚
â”‚  â–¼ Tools & Skills                    â”‚                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                   â”‚
â”‚                                       â”‚                   â”‚
â”‚  â–¼ Permissions                       â”‚                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                   â”‚
â”‚                                       â”‚                   â”‚
â”‚  â–¼ Memory Settings                   â”‚                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                   â”‚
â”‚                                       â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                   â”‚
â”‚  â”‚      Test Agent          â”‚         â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Section 1: Identity

**Avatar:**
- Large circular avatar preview (96px)
- Tap to change:
  - **Emoji Picker** â€” Select from emoji library
  - **Icon Library** â€” Select from icon set
  - **Upload Image** â€” Choose from gallery or camera
  - **Remove** â€” Reset to default
- Saved avatar displays in agent card and chat

**Name:**
- Text field
- Max length: 50 characters
- Required field
- Shows in agent card, chat header, command bar

**Description:**
- Text field (multiline)
- Max length: 200 characters
- Optional
- Shows in agent card on hover/long-press
- Helps user remember agent's purpose

### Section 2: Model Settings

**Provider Selection:**
- Dropdown of configured providers (from UC-8.1)
- Shows: Provider name, status (green check = valid)
- Default: User's default provider

**Model Selection:**
- Dropdown of available models for selected provider
- Models grouped by type:
  - **Chat/General:** GPT-4, Claude, Gemini Pro, etc.
  - **Code:** Codex, CodeLlama, etc.
  - **Fast/Cheap:** GPT-3.5, Claude Instant, etc.
- Shows model details on hover:
  - Context window size
  - Cost per 1K tokens
  - Capabilities

**Temperature Slider:**
- Range: 0.0 - 2.0
- Default: 0.7
- Visual: Slider with numeric value
- Labels: "Focused (0)" â† â†’ "Creative (2)"
- Tooltip explaining temperature

**Max Tokens:**
- Number field
- Default: Provider's default
- Range: 1 - Model's max
- Shows approximate cost in user's currency

**Additional Settings (Advanced):**
- Top P
- Frequency Penalty
- Presence Penalty
- Stop sequences
- Expandable "Advanced Options" section

### Section 3: System Prompt

**Text Area:**
- Large multiline text field
- Max length: 4000 characters (or model limit)
- Character counter
- Placeholder examples:
  - "You are a helpful assistant that..."
  - "Act as a senior software engineer who..."
  - "You are an expert in [domain]..."

**Prompt Templates:**
- Dropdown with pre-built templates:
  - "General Assistant"
  - "Code Reviewer"
  - "Research Analyst"
  - "Creative Writer"
  - "Data Analyst"
  - "Custom" (blank)
- Selecting template populates text area

**Prompt Guidelines:**
- Collapsible help section:
  - Best practices
  - Example prompts
  - Variables/placeholders syntax

### Section 4: Tools & Skills

**Available Tools:**
Toggle list of available tools with:

| Tool | Toggle | Status | Required Permissions |
|------|--------|--------|---------------------|
| ğŸŒ Web Search | ON | Ready | Internet access |
| ğŸ“ File Access | OFF | Not configured | File system read/write |
| ğŸ“§ Email | OFF | Needs setup | Email account access |
| ğŸ“… Calendar | OFF | Needs setup | Calendar access |
| ğŸ’» Code Execution | ON | Ready | Sandboxed environment |
| ğŸ—„ï¸ Database | OFF | Not configured | Database connection |
| ğŸ”Œ Custom APIs | OFF | Add endpoints | API credentials |

**Tool Status Indicators:**
- âœ… Ready â€” Configured and available
- âš ï¸ Needs setup â€” Requires additional configuration
- âŒ Not configured â€” Not set up

**Tool Configuration:**
- Tap tool to expand configuration options
- Each tool has specific settings:
  - **Web Search:** Enable/disable sources, rate limits
  - **File Access:** Select directories, read/write permissions
  - **Email:** Connect account, select folders
  - **Calendar:** Connect account, select calendars
  - **Code Execution:** Enable/disable, timeout settings

**Custom Tools:**
- "Add Custom Tool" button
- Opens form for:
  - Tool name
  - Description
  - API endpoint or MCP server URL
  - Authentication method
  - Parameters schema

### Section 5: Permissions

**Action Permission Level:**
Radio buttons or segmented control:
- **Full Autonomy** â€” Agent can act without approval
- **Ask for Critical Actions** â€” Only risky actions need approval
- **Ask for Everything** â€” All actions need approval (default)
- **No Actions Allowed** â€” Agent cannot perform real actions

**Specific Permissions:**
Grid of toggles for specific actions:

| Action | Allow | Require Approval | Deny |
|--------|-------|------------------|------|
| Send emails | â—‹ | â— | â—‹ |
| Create files | â—‹ | â— | â—‹ |
| Delete files | â—‹ | â—‹ | â— |
| Make API calls | â—‹ | â— | â—‹ |
| Schedule events | â—‹ | â— | â—‹ |
| Access contacts | â—‹ | â—‹ | â— |
| Access location | â—‹ | â—‹ | â— |

### Section 6: Memory Settings

**Conversation Memory:**
- Toggle: On/Off
- When off, each conversation starts fresh

**Context Window:**
- Slider or dropdown for message history limit
- Options: Last 5, 10, 20, 50 messages, Unlimited
- Shows token count estimate

**Long-term Memory:**
- Toggle: On/Off
- When on, agent remembers facts across conversations
- "Manage Memories" button â†’ View/edit stored memories

**Memory Categories:**
- User preferences
- Conversation summaries
- Facts about user
- Project context

### Test Button:

**Behavior:**
- Opens temporary chat in a modal/bottom-sheet
- Uses current configuration (even if not saved)
- Chat has "Save Configuration" and "Discard" buttons
- Temporary chat is discarded if configuration is discarded

**Test Chat Features:**
- Full chat functionality
- Shows active configuration summary
- "Apply Changes" saves config and keeps chat open
- "Discard" closes test chat and reverts config

### Save Behavior:

**Validation:**
- Check required fields (name, model)
- Validate tool configurations
- Check for conflicting permissions

**Save Actions:**
- "Save" button in header
- Disabled if validation fails
- Success: Toast message, navigate back
- Error: Show inline errors

### State Management:
- Track form state (original vs. current)
- Warn on unsaved changes when navigating away
- Auto-save draft periodically (optional)
- Track test chat state separately

## ZFA Architecture Requirements

### Entity Definition

Uses existing **Agent** entity (UC-1.2) and **Tool** entity (UC-8.2).

**AgentDraft Entity** (for unsaved edits):
```bash
zfa entity create -n AgentDraft --field "id:String,agentId:String,name:String?,avatar:String?,description:String?,systemPrompt:String?,temperature:double?,maxTokens:int?,tools:List<String>?,permissions:Map<String,dynamic>?,memory:Map<String,dynamic>?,updatedAt:DateTime" --json
```

### Clean Architecture Generation

```bash
zfa generate Agent --methods=get,getList,create,update,delete --data --vpc --state
zfa generate AgentDraft --methods=get,create,update,delete --data --vpc --state
```

### Implementation Notes

1. **Live Preview**: Use `AgentState.agent` to render preview card
2. **Draft Save**: Auto-save to `AgentDraft` while editing
3. **Test Mode**: Create temporary chat session with draft config

