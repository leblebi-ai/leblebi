## Acceptance Criteria
- [ ] User can create a "room" and add 2+ agents
- [ ] Each agent has distinct avatar and colored name label in thread
- [ ] User messages broadcast to all agents (or @mention specific agent)
- [ ] Agents can respond to each other's outputs (threaded or linear, user toggles)
- [ ] User can mute/unmute individual agents mid-conversation
- [ ] Visual indicator showing which agent is currently "thinking"
- [ ] All entities generated using ZFA (Zorphy) with JSON serialization
- [ ] All Clean Architecture layers generated using ZFA generate command
- [ ] State management using ZFA-generated State classes

## Task
Implement multi-agent chat (War Room) feature for collaborative agent interactions.

### Room Creation:

**Entry Points:**
- From dashboard FAB â†’ "New War Room"
- From chat screen â†’ "Add agents to room" in overflow menu
- From command bar â†’ `/warroom` command

**Room Setup Flow:**
1. Modal dialog with:
   - Room name field (optional, auto-generates if empty)
   - Agent selection list (checkboxes, minimum 2 required)
   - Selected agents preview with avatars
2. "Create Room" button (enabled only when 2+ agents selected)
3. Room appears in chat list with combined avatar

### Room Layout:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  [ğŸ‘¥] War Room Name        âš™ï¸   â”‚  â† App Bar with participants
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Participants bar - scrollable]    â”‚
â”‚  ğŸ¤–Agent1 ğŸ“ŠAgent2 ğŸ“Agent3  [+]    â”‚  â† Agent avatars, tap to mute
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ¤– Agent 1                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Agent 1 message    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                     â”‚
â”‚  ğŸ“Š Agent 2                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Agent 2 response   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚            â”‚ @Agent1 User msg   â”‚  â”‚  â† User @mentions specific agent
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  ğŸ¤– Agent 1 â— â— â— thinking...      â”‚  â† Thinking indicator per agent
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“  [Type @ to mention... ]  ğŸ¤ â¤â”‚  â† Input with @mention support
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent Identification:

**Avatar + Label:**
- Each agent has a distinct avatar (emoji, icon, or image)
- Colored name label above each message
- Color coding: Each agent gets a unique color from a palette
- Color persists throughout conversation

**Name Label Styles:**
- Pill-shaped badge with agent name
- Background: Agent's assigned color (light shade)
- Text: Agent's assigned color (dark shade)
- Border: Agent's assigned color

### Message Broadcasting:

**Default Behavior:**
- User message is broadcast to all non-muted agents
- All agents see the same user message
- Agents respond independently (may be simultaneous)

**@Mention:**
- Type `@` to show agent mention autocomplete
- Filter as you type
- Select agent to mention
- Mentioned message goes only to mentioned agent(s)
- Mentioned agent(s) highlighted in message
- Format: `@AgentName message content`

### Response Modes:

**Linear Mode (Default):**
- All messages appear in chronological order
- Agent responses shown as they arrive
- Easy to follow conversation flow

**Threaded Mode:**
- Each agent's response is a reply to the original user message
- Threads can be expanded/collapsed
- Better for comparing different agent perspectives
- Toggle in app bar or settings

### Mute/Unmute Agents:

**Participants Bar:**
- Horizontal scrollable row of agent avatars
- Tap avatar to toggle mute state
- Muted agents show with strikethrough or dimmed
- Count badge: "2 muted"

**Mute Behavior:**
- Muted agents don't receive broadcast messages
- Muted agents can still be @mentioned
- Muted agents don't generate responses unless @mentioned
- Unmute restores normal behavior

**Mute Indicator:**
- Visual: Avatar dimmed with ğŸ”‡ icon overlay
- Status text: "[Agent name] is muted"

### Thinking Indicator:

**Per-Agent Indicators:**
- Each agent shows its own thinking state
- Format: `[Avatar] [Agent Name] â— â— â— thinking...`
- Animated dots
- Appears when agent starts processing
- Disappears when response begins streaming

**Combined Indicator:**
- If multiple agents thinking simultaneously:
  - Show "3 agents thinking..."
  - Expandable to see which agents

### Agent-to-Agent Interaction:

**Allow Responses to Other Agents:**
- Toggle in room settings: "Allow agents to respond to each other"
- When enabled:
  - Agents see other agents' messages
  - Agents can respond to or build on other agents' outputs
  - Creates dynamic multi-agent conversation

**Response Chain Visualization:**
- Optional: Show which message an agent is responding to
- "In response to Agent 2" indicator
- Tap to scroll to referenced message

### Room Management:

**Room Settings (âš™ï¸):**
- Rename room
- Add/remove agents
- Toggle response mode (linear/threaded)
- Toggle agent-to-agent responses
- Clear room history
- Delete room

**Room List:**
- War rooms appear in chat list
- Combined avatar (collage of participant avatars)
- Participant names as subtitle
- Unread badge with count

### Use Cases:
- **Brainstorming:** Multiple agents provide different perspectives
- **Research:** Compare research from different specialized agents
- **Competing drafts:** Get multiple versions of content
- **Cross-validation:** One agent checks another's work
- **Debate:** Agents argue different viewpoints

### State Management:
- Track room membership
- Track per-agent mute state
- Track response mode preference
- Track thread state (if threaded mode)
- Persist room configuration
- Sync messages across participants

### Performance:
- Stream responses from multiple agents concurrently
- Handle simultaneous message arrivals
- De-duplicate if necessary
- Manage rate limiting across agents

## ZFA Architecture Requirements

### Entity Definition

**Room Entity:**
```bash
zfa entity create -n Room --field "id:String,name:String,agentIds:List<String>,mutedAgentIds:List<String>,responseMode:String,createdAt:DateTime,updatedAt:DateTime" --json
```

**RoomMessage Entity:**
```bash
zfa entity create -n RoomMessage --field "id:String,roomId:String,senderType:String,senderId:String,senderName:String,content:String,mentionAgentIds:List<String>?,createdAt:DateTime" --json
```

### Clean Architecture Generation

```bash
zfa generate Room --methods=get,getList,create,update,delete --data --vpc --state
zfa generate RoomMessage --methods=get,getList,create --data --vpc --state
```

### Implementation Notes

1. **Broadcast**: When `mentionAgentIds` is empty, send to all non-muted agents
2. **Mute State**: Store in `mutedAgentIds` list, update via `UpdateRoomUseCase`
3. **Thinking Indicator**: Track per-agent thinking state in local state

