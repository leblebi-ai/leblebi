## Acceptance Criteria
- [ ] Accessible from anywhere in the app (global gesture or shortcut)
- [ ] Text input with auto-complete suggestions
- [ ] Suggestions include: recent commands, agent names (@), workflow names (/run), actions (/new, /settings, /keys)
- [ ] Natural language without @ routes to default agent
- [ ] @AgentName routes directly to specific agent
- [ ] Results appear inline below command bar
- [ ] Dismissible with swipe down or Escape
- [ ] All entities generated using ZFA (Zorphy) with JSON serialization
- [ ] All Clean Architecture layers generated using ZFA generate command
- [ ] State management using ZFA-generated State classes

## Task
Implement the Command Bar â€” a universal launcher for quick access to agents, workflows, and commands.

### Access Methods:

**Mobile:**
- Pull-down gesture from top of screen
- Swipe down from any screen
- Command bar slides down from top

**Desktop:**
- `Cmd+K` (macOS) / `Ctrl+K` (Windows/Linux)
- Global keyboard shortcut works from anywhere
- Command bar appears centered on screen

**Additional Access:**
- Tap search icon in app bar
- Long-press app icon (iOS Quick Actions / Android Shortcuts)

### Command Bar Design:

**Mobile (Slide-down):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” [Type a command or message...]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Recent                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ @Research summarize this URL â”‚   â”‚
â”‚  â”‚ /run Daily Briefing          â”‚   â”‚
â”‚  â”‚ @Email check inbox           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  Suggestions                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¤– @GeneralAssistant        â”‚   â”‚
â”‚  â”‚ ğŸ” @ResearchAgent           â”‚   â”‚
â”‚  â”‚ ğŸ“§ @EmailAgent              â”‚   â”‚
â”‚  â”‚ ğŸ”„ /run Email Triage        â”‚   â”‚
â”‚  â”‚ ğŸ”„ /run Daily Briefing      â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ â• /new agent               â”‚   â”‚
â”‚  â”‚ â• /new workflow            â”‚   â”‚
â”‚  â”‚ âš™ï¸ /settings                â”‚   â”‚
â”‚  â”‚ ğŸ”‘ /keys                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Desktop (Modal):**
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ğŸ” [Type a command or message...]  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚  Recent                             â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚ @Research summarize this URL â”‚   â”‚
                    â”‚  â”‚ /run Daily Briefing          â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚                                     â”‚
                    â”‚  Suggestions                        â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚ ğŸ¤– @GeneralAssistant      â–¶ â”‚   â”‚
                    â”‚  â”‚ ğŸ” @ResearchAgent         â–¶ â”‚   â”‚
                    â”‚  â”‚ ğŸ“§ @EmailAgent            â–¶ â”‚   â”‚
                    â”‚  â”‚ ğŸ”„ /run Email Triage      â–¶ â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Input Field:

**Features:**
- Large, prominent text field
- Placeholder: "Type a command or message..."
- Auto-focus on open
- Auto-expand for long inputs (up to 5 lines)
- Paste support (URLs, text, code)

**Input Types:**
1. **Natural Language:** "Summarize this article for me"
2. **Agent Mention:** "@ResearchAgent analyze this data"
3. **Workflow Command:** "/run Daily Briefing"
4. **Action Command:** "/new agent", "/settings"

### Auto-complete Suggestions:

**Categories:**

**1. Recent Commands:**
- Last 5-10 commands
- Timestamp (e.g., "2 min ago")
- Clear recent history option

**2. Agent Suggestions (@):**
- When typing `@`, show all agents
- Filter as user types: `@Res` â†’ shows ResearchAgent
- Each suggestion shows:
  - Agent avatar
  - Agent name
  - Status indicator
  - Keyboard shortcut (desktop)

**3. Workflow Suggestions (/run):**
- When typing `/run`, show all workflows
- Filter as user types
- Each suggestion shows:
  - Workflow icon
  - Workflow name
  - Status (active/inactive)
  - Last run time

**4. Action Commands:**
- `/new agent` â€” Open agent creation
- `/new workflow` â€” Open workflow builder
- `/settings` â€” Open settings
- `/keys` â€” Open API key manager
- `/help` â€” Show help/shortcuts
- `/feedback` â€” Send feedback
- `/tour` â€” Replay onboarding tour

### Routing Behavior:

**Natural Language (no prefix):**
```
Input: "What's the weather today?"
Action: Routes to default agent
Output: Opens chat with default agent, sends message
```

**Agent Mention (@):**
```
Input: "@ResearchAgent summarize this article [URL]"
Action: Routes directly to ResearchAgent
Output: Opens ResearchAgent chat, sends message
```

**Multiple Mentions (@):**
```
Input: "@ResearchAgent @EmailAgent analyze and send report"
Action: Opens War Room with both agents
Output: Creates temporary room, sends message to both
```

**Workflow Command (/run):**
```
Input: "/run Daily Briefing"
Action: Executes workflow
Output: Opens workflow execution view
```

**Action Command:**
```
Input: "/new agent"
Action: Navigates to agent creation screen
Output: Opens agent creation flow
```

### Inline Results:

**For Quick Answers:**
When agent can respond quickly (short answer):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” What is the capital of France?  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¤– General Assistant         â”‚   â”‚
â”‚  â”‚ The capital of France is     â”‚   â”‚
â”‚  â”‚ Paris.                       â”‚   â”‚
â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ [Continue in chat]           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  [Tap for more options]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**For Complex Responses:**
When response requires more space or interaction:
- Shows preview/summary
- "Continue in chat" button
- Tapping opens full chat view

**For Workflow Execution:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” /run Daily Briefing             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”„ Daily Briefing            â”‚   â”‚
â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ Starting workflow...         â”‚   â”‚
â”‚  â”‚ â— Running                    â”‚   â”‚
â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ [View Execution]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Keyboard Navigation (Desktop):

**Shortcuts:**
- `Cmd/Ctrl + K` â€” Open command bar
- `â†‘` `â†“` â€” Navigate suggestions
- `Enter` â€” Select suggestion / Send command
- `Tab` â€” Cycle through suggestion categories
- `Escape` â€” Close command bar
- `Cmd/Ctrl + Enter` â€” Send without closing

**Quick Agent Shortcuts:**
- `Cmd/Ctrl + 1` â€” Open default agent
- `Cmd/Ctrl + 2` â€” Open second agent
- etc.

### Command History:

**Recent Commands:**
- Stored locally
- Synced across devices (if signed in)
- Searchable
- Clearable

**History Features:**
- Show last 10 commands by default
- "See all" for full history
- Pin frequently used commands
- Remove individual entries

### Context Awareness:

**Smart Suggestions:**
- If on Dashboard: Suggest agents and workflows
- If in Chat: Suggest related agents or actions
- If file selected: Suggest relevant agents

**Clipboard Detection:**
- If clipboard contains URL: Suggest "Summarize URL"
- If clipboard contains code: Suggest "Explain code"
- If clipboard contains email: Suggest "Draft reply"

### Dismissal:

**Methods:**
- Swipe down (mobile)
- Press Escape (desktop)
- Tap outside command bar
- Tap close button (X)

**State Preservation:**
- Preserve typed text on dismiss
- Restore on next open
- Option to clear on dismiss

### Error Handling:

**No Default Agent:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ No Default Agent Set            â”‚
â”‚                                     â”‚
â”‚  Set a default agent to use quick   â”‚
â”‚  commands, or use @ to mention a    â”‚
â”‚  specific agent.                    â”‚
â”‚                                     â”‚
â”‚  [Set Default Agent]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Agent Not Found:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Agent "@UnknownAgent" not found â”‚
â”‚                                     â”‚
â”‚  Did you mean:                      â”‚
â”‚  â€¢ @ResearchAgent                   â”‚
â”‚  â€¢ @EmailAgent                      â”‚
â”‚                                     â”‚
â”‚  [Create new agent]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Workflow Not Found:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Workflow "Unknown" not found    â”‚
â”‚                                     â”‚
â”‚  Available workflows:               â”‚
â”‚  â€¢ /run Daily Briefing              â”‚
â”‚  â€¢ /run Email Triage                â”‚
â”‚                                     â”‚
â”‚  [Create new workflow]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Management:

**Command Bar State:**
```javascript
{
  isOpen: boolean,
  inputText: string,
  suggestions: Suggestion[],
  recentCommands: Command[],
  selectedIndex: number,
  activeCategory: enum
}
```

### Performance:
- Instant open (no loading delay)
- Debounced suggestion updates
- Virtual scrolling for long suggestion lists
- Cached suggestions for quick display

## ZFA Architecture Requirements

### Entity Definition

**CommandHistory Entity:**
```bash
zfa entity create -n CommandHistory --field "id:String,command:String,type:String,executedAt:DateTime" --json
```

### Clean Architecture Generation

```bash
zfa generate CommandHistory --methods=get,getList,create,delete --data --vpc --state
```

### Implementation Notes

1. **Recent Commands**: Query `CommandHistory` ordered by `executedAt` desc
2. **Suggestions**: Combine recent commands with agent/workflow lists
3. **Routing**: Parse command prefix (@, /run) to determine destination

